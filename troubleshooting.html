

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Troubleshooting &mdash; Franka Control Interface (FCI)  documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/style_override.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Franka Control Interface (FCI)  documentation" href="index.html"/>
        <link rel="next" title="FAQ" href="faq.html"/>
        <link rel="prev" title="Robot and interface specifications" href="control_parameters.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Franka Control Interface (FCI)
          

          
            
            <img src="_static/logo.svg" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Minimum system and network requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation_linux.html">Installation on Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation_windows.html">Installation on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="libfranka.html">libfranka</a></li>
<li class="toctree-l1"><a class="reference internal" href="libfranka_changelog.html">libfranka changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="franka_ros.html">franka_ros</a></li>
<li class="toctree-l1"><a class="reference internal" href="franka_ros_changelog.html">franka_ros changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="control_parameters.html">Robot and interface specifications</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#running-a-libfranka-executable-fails-with-connection-timeout">Running a libfranka executable fails with “Connection timeout”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#motion-stopped-due-to-discontinuities-or-communication-constraints-violation">Motion stopped due to discontinuities or <code class="docutils literal"><span class="pre">communication_constraints_violation</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#disabling-cpu-frequency-scaling">Disabling CPU frequency scaling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#robot-is-not-reachable">Robot is not reachable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-a-libfranka-executable-fails-with-udp-receive-timeout">Running a libfranka executable fails with “UDP receive: Timeout”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#network-bandwidth-delay-and-jitter-test">Network bandwidth, delay and jitter test</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-ping-tests">Simple ping tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-network-performance-analysis">Advanced network performance analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Franka Control Interface (FCI)</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Troubleshooting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/troubleshooting.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<p>This section lists solutions to a set of possible errors which can happen when using the FCI.</p>
<blockquote>
<div><div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Further help is provided in the troubleshooting page of the manual shipped with your robot.</p>
</div>
</div></blockquote>
<div class="section" id="running-a-libfranka-executable-fails-with-connection-timeout">
<span id="troubleshooting-connection-timeout"></span><h2>Running a libfranka executable fails with “Connection timeout”<a class="headerlink" href="#running-a-libfranka-executable-fails-with-connection-timeout" title="Permalink to this headline">¶</a></h2>
<p>This error occurs if <code class="docutils literal"><span class="pre">libfranka</span></code> cannot connect to the robot at all. Please check that:</p>
<blockquote>
<div><ul class="simple">
<li>Using a robot with system version 4.2.0 or higher requires to enable the FCI mode. To do that
open Desk -&gt; expand the menu in the sidebar -&gt; press <cite>‘Activate FCI’</cite>. Further information
about Single Point of Control (SPoC) can be found in the manual shipped with the robot.</li>
<li>Your workstation is directly connected to Control, not the LAN port of the Arm (see
<a class="reference internal" href="requirements.html#requirement-network"><span class="std std-ref">Network</span></a>).</li>
<li>The robot can be reached from your workstation (see <a class="reference internal" href="#troubleshooting-robot-not-reachable"><span class="std std-ref">Robot is not reachable</span></a>).</li>
<li>The FCI feature file is installed on the robot (see “Settings -&gt; System -&gt; Installed Features”).</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="motion-stopped-due-to-discontinuities-or-communication-constraints-violation">
<span id="motion-stopped-due-to-discontinuities"></span><h2>Motion stopped due to discontinuities or <code class="docutils literal"><span class="pre">communication_constraints_violation</span></code><a class="headerlink" href="#motion-stopped-due-to-discontinuities-or-communication-constraints-violation" title="Permalink to this headline">¶</a></h2>
<p>If the difference between commanded values in subsequent time steps is too large, then the motion is
stopped with a discontinuity error such as <code class="docutils literal"><span class="pre">joint_motion_generator_velocity_discontinuity</span></code>. See if
the commanded values do not exceed the <a class="reference internal" href="control_parameters.html#limit-table"><span class="std std-ref">limits</span></a>.</p>
<p>Discontinuities can occur if your code commands actual jumps to the robot, but also because of
network packet losses. This is also the reason for <code class="docutils literal"><span class="pre">communication_constraints_violation</span></code> errors.
If the issue occurs even when using the provided examples, the problem is most likely related to
overall communication quality. To ensure best performance, please check the following:</p>
<blockquote>
<div><ul class="simple">
<li>All source code is compiled with optimizations (<code class="docutils literal"><span class="pre">-DCMAKE_BUILD_TYPE=Release</span></code>). If you installed
<code class="docutils literal"><span class="pre">libfranka</span></code> and <code class="docutils literal"><span class="pre">franka_ros</span></code> from the ROS repositories, this is already the case for these
projects. However, your own source code needs to be compiled with optimizations as well.</li>
<li>Connect your PC directly to Control, without using any intermediate switches. The
<a class="reference internal" href="getting_started.html#setting-up-the-network"><span class="std std-ref">network setup instructions</span></a> describe how to do this.</li>
<li>Verify your network connection by executing the <a class="reference internal" href="#network-bandwidth-delay-and-jitter-test">network bandwidth, delay and jitter test</a>.</li>
<li><code class="docutils literal"><span class="pre">franka::Robot</span></code> is instantiated with <code class="docutils literal"><span class="pre">RealtimeConfig::kEnforce</span></code>. This is the default if no
<code class="docutils literal"><span class="pre">RealtimeConfig</span></code> is explicitly specified in the constructor.</li>
<li>Power saving features are disabled (cpu frequency scaling, power saving mode,
laptop on battery, BIOS power saving features, etc.). See <a class="reference internal" href="#disabling-cpu-frequency-scaling">Disabling CPU frequency scaling</a>.</li>
</ul>
</div></blockquote>
<div class="section" id="disabling-cpu-frequency-scaling">
<span id="disable-cpu-frequency-scaling"></span><h3>Disabling CPU frequency scaling<a class="headerlink" href="#disabling-cpu-frequency-scaling" title="Permalink to this headline">¶</a></h3>
<p>CPUs are often configured to use a lower operating frequency when under a light load in order to
conserve power. We recommend to disable this feature as it leads to higher latencies when using
<code class="docutils literal"><span class="pre">libfranka</span></code>. To check and modify the power saving mode, install the <code class="docutils literal"><span class="pre">cpufrequtils</span></code> package:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>sudo apt install cpufrequtils
</pre></div>
</div>
<p>Run <code class="docutils literal"><span class="pre">cpufreq-info</span></code> to see available “governors” and the current CPU frequency. Here is an example
output:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ cpufreq-info
...
analyzing CPU <span class="m">0</span>:
  driver: intel_pstate
  CPUs which run at the same hardware frequency: <span class="m">0</span>
  CPUs which need to have their frequency coordinated by software: <span class="m">0</span>
  maximum transition latency: <span class="m">0</span>.97 ms.
  hardware limits: <span class="m">400</span> MHz - <span class="m">3</span>.00 GHz
  available cpufreq governors: performance, powersave
  current policy: frequency should be within <span class="m">400</span> MHz and <span class="m">3</span>.00 GHz.
                  The governor <span class="s2">&quot;powersave&quot;</span> may decide which speed to use
                  within this range.
  current CPU frequency is <span class="m">500</span> MHz.
...
</pre></div>
</div>
<p>In this example, the maximum frequency is 3 GHz, but the current one is 500 Mhz due to the
<code class="docutils literal"><span class="pre">powersave</span></code> policy. In this case we can benefit by setting the governor to <code class="docutils literal"><span class="pre">performance</span></code>.</p>
<p>To change this setting using the Ubuntu GUI, install the <code class="docutils literal"><span class="pre">indicator-cpufreq</span></code> package. A widget in
the top bar of the Unity user interface should allow you to set the current policy.</p>
<p>To change this setting using the terminal, execute the following commands:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>sudo systemctl disable ondemand
sudo systemctl <span class="nb">enable</span> cpufrequtils
sudo sh -c <span class="s1">&#39;echo &quot;GOVERNOR=performance&quot; &gt; /etc/default/cpufrequtils&#39;</span>
sudo systemctl daemon-reload <span class="o">&amp;&amp;</span> sudo systemctl restart cpufrequtils
</pre></div>
</div>
<p>They will disable the <code class="docutils literal"><span class="pre">ondemand</span></code> CPU scaling daemon, create a <code class="docutils literal"><span class="pre">/etc/default/cpufrequtils</span></code>
configuration file, and then restart the <code class="docutils literal"><span class="pre">cpufrequtils</span></code> service.</p>
<p>After enabling the <code class="docutils literal"><span class="pre">performance</span></code> governor, the <code class="docutils literal"><span class="pre">cpufreq-info</span></code> results are:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ cpufreq-info
...
analyzing CPU <span class="m">0</span>:
  driver: intel_pstate
  CPUs which run at the same hardware frequency: <span class="m">0</span>
  CPUs which need to have their frequency coordinated by software: <span class="m">0</span>
  maximum transition latency: <span class="m">0</span>.97 ms.
  hardware limits: <span class="m">400</span> MHz - <span class="m">3</span>.00 GHz
  available cpufreq governors: performance, powersave
  current policy: frequency should be within <span class="m">400</span> MHz and <span class="m">3</span>.00 GHz.
                  The governor <span class="s2">&quot;performance&quot;</span> may decide which speed to use
                  within this range.
  current CPU frequency is <span class="m">2</span>.83 GHz.
...
</pre></div>
</div>
<p>Now the example output shows a CPU frequency close to the maximum one. You can
also directly verify the current governor using the <code class="docutils literal"><span class="pre">cpufreq-info</span> <span class="pre">-p</span></code> command.</p>
</div>
</div>
<div class="section" id="robot-is-not-reachable">
<span id="troubleshooting-robot-not-reachable"></span><h2>Robot is not reachable<a class="headerlink" href="#robot-is-not-reachable" title="Permalink to this headline">¶</a></h2>
<p>Try to ping the robot using the following command:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>ping &lt;fci-ip&gt;
</pre></div>
</div>
<p>If this command fails, the robot is not properly connected to the network, or the IP address
is not correctly assigned during the setup phase. Please set up the network according to the
documents sent with your robot.</p>
</div>
<div class="section" id="running-a-libfranka-executable-fails-with-udp-receive-timeout">
<span id="troubleshooting-udp-timeout"></span><h2>Running a libfranka executable fails with “UDP receive: Timeout”<a class="headerlink" href="#running-a-libfranka-executable-fails-with-udp-receive-timeout" title="Permalink to this headline">¶</a></h2>
<p>This error occurs if the robot state can not be received by <code class="docutils literal"><span class="pre">libfranka</span></code>. Please check that
your workstation’s firewall does not block incoming UDP packets (see <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">iptables</span> <span class="pre">-L</span></code>).</p>
</div>
<div class="section" id="network-bandwidth-delay-and-jitter-test">
<span id="network-bandwidth-delay-test"></span><h2>Network bandwidth, delay and jitter test<a class="headerlink" href="#network-bandwidth-delay-and-jitter-test" title="Permalink to this headline">¶</a></h2>
<p>In order to evaluate the network performance of your (possible) control PC we’ve developed two
tests. The first, a ping test, can be executed without the need of libfranka or franka_ros
installed on your system. If your system passes the first ping test, you can run the
advanced UDP network performance analysis.</p>
<div class="section" id="simple-ping-tests">
<span id="network-ping-test"></span><h3>Simple ping tests<a class="headerlink" href="#simple-ping-tests" title="Permalink to this headline">¶</a></h3>
<p>The following command will simulate a network load which is equivalent to a scenario where the
robot is controlled by the FCI:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>sudo ping &lt;fci-ip&gt; -i <span class="m">0</span>.001 -D -c <span class="m">10000</span> -s <span class="m">1200</span>
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>PING &lt;fci-ip&gt; <span class="m">1200</span><span class="o">(</span><span class="m">1228</span><span class="o">)</span> bytes of data.
<span class="o">[</span><span class="m">1500982522</span>.977579<span class="o">]</span> <span class="m">1208</span> bytes from &lt;fci-ip&gt;: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nv">time</span><span class="o">=</span><span class="m">0</span>.279 ms
<span class="o">[</span><span class="m">1500982522</span>.978423<span class="o">]</span> <span class="m">1208</span> bytes from &lt;fci-ip&gt;: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nv">time</span><span class="o">=</span><span class="m">0</span>.224 ms
<span class="o">[</span><span class="m">1500982522</span>.979434<span class="o">]</span> <span class="m">1208</span> bytes from &lt;fci-ip&gt;: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">3</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nv">time</span><span class="o">=</span><span class="m">0</span>.196 ms
<span class="o">[</span><span class="m">1500982522</span>.980482<span class="o">]</span> <span class="m">1208</span> bytes from &lt;fci-ip&gt;: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">4</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nv">time</span><span class="o">=</span><span class="m">0</span>.243 ms
....
<span class="o">[</span><span class="m">1500982533</span>.034267<span class="o">]</span> <span class="m">1208</span> bytes from &lt;fci-ip&gt;: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">9999</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nv">time</span><span class="o">=</span><span class="m">0</span>.236 ms
<span class="o">[</span><span class="m">1500982533</span>.035211<span class="o">]</span> <span class="m">1208</span> bytes from &lt;fci-ip&gt;: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">10000</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nv">time</span><span class="o">=</span><span class="m">0</span>.203 ms

--- &lt;fci-ip&gt; ping statistics ---
<span class="m">10000</span> packets transmitted, <span class="m">10000</span> received, <span class="m">0</span>% packet loss, <span class="nb">time</span> 10057ms
rtt min/avg/max/mdev <span class="o">=</span> <span class="m">0</span>.147/0.240/0.502/0.038 ms
</pre></div>
</div>
<p>The example result shows an average round-trip time of 0.24 ms and a maximum round-trip time of 0.5
ms. The standard deviation <cite>mdev</cite> is around 0.04 ms. As explained in the
<a class="reference internal" href="requirements.html#requirement-network"><span class="std std-ref">network requirements section</span></a> it must be guaranteed that the sum of the
round-trip time and the execution time of the motion generator or control loop is
<strong>less than 1 ms</strong>. If this constraint is violated for a cycle, the received packet is dropped by
the FCI.</p>
<p>If the round-trip time is long even with a direct connection, consider
purchasing a separate, high performance PCI-Express network card for your
workstation PC. See if there are dedicated drivers for your network card,
these usually offer better performance. Lastly, the CPU can also be a limiting
factor for network performance.</p>
</div>
<div class="section" id="advanced-network-performance-analysis">
<h3>Advanced network performance analysis<a class="headerlink" href="#advanced-network-performance-analysis" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">communication_test</span></code> executable, which is part of the <code class="docutils literal"><span class="pre">libfranka</span></code> examples since
version 0.5, executes a control loop and provides feedback about the lost robot
states as well as the maximum, minimum and average control command success rate.</p>
<p>If you installed the <code class="docutils literal"><span class="pre">ros-kinetic-libfranka</span></code> package, you can execute the test with:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>rosrun libfranka communication_test &lt;fci-ip&gt;
</pre></div>
</div>
<p>To run the test after compiling <code class="docutils literal"><span class="pre">libfranka</span></code> from source, execute:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>./examples/communication_test &lt;fci-ip&gt;
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="faq.html" class="btn btn-neutral float-right" title="FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="control_parameters.html" class="btn btn-neutral" title="Robot and interface specifications" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Franka Emika GmbH.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>